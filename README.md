# DocumentWorker

## Краткое описание проекта
DocumentWorker - это проект, который содержит в себе 3 сущности: консольный клиент, АПИ для взаимодействия с БД, АПИ клиент для общения с апи. 
Задача проекта - загрузка данных из текстового файла в базу данных, согласно ТЗ, которое указано пунктом ниже.

## Требования к проекту
1. Приложение должно загружать в базу данных из входного текстового файла (который может содержать текст на английском и русском языках, в кодировке UTF-8) все слова, удовлетворяющие следующим критериям:

	* длина слова не менее 3 и не более 20 символов;

	* слово упоминается в текущем входном файле не менее 4-ёх раз.

2. Загрузка может выполняться многократно. При этом приложение не должно удалять существующие данные из базы данных, а должно дополнять их.

3. В базе данных для каждого сохранённого слова должно храниться количество его упоминаний, суммарное для всех загруженных файлов (т.е. в результате загрузки каждого нового файла существующее в базе данных количество упоминаний должно быть увеличено на количество упоминаний в новом файле).

4. Текстовый файл, подаваемый на вход, должен быть в кодировке UTF-8. Файл может содержать любые буквы (латиница и кириллица) и пробелы. Файл может содержать более одной строки. Файл может иметь размер до 100 МБ.

5. Приложение должно корректно обновлять информацию в базе данных в случае, если одновременно выполняется несколько копий этого приложения, работающих с одной и той же базой данных.
   
7. Приложение должно автоматически создавать и инициализировать базу данных (включая её таблицы и т.д.) в случае, если таковая отсутствует; либо должен быть предоставлен SQL-скрипт для её первичного создания.

8. База данных должна быть реализована с использованием MS SQL Server / SQL Server Express.

## Подробное описание проекта
У проекта DocumentWorker есть 3 сущности:
1. Консольное клиент - по сути эти клиент для пользователей, который читает файл по определенным правилам и когда все данные обработанны -> посылает POST запрос используя APIDB клиент и на этом его жизненый цикл кончается;
2. WEB API DB - апи, которое общается с клиентами и БД, у него есть несколько основных жизненых циклов:
    * Условно первый жизненый цикл начинается при получении запроса от клиента, после этого список слов полученный от клиента передается в сервис, который создает Background Job для вставки данных в WordInfoTemps таблицу;
    * Условно второй жизненый цикл заключается в том, что у АПИ крутится Job, которая каждая 10 секунд опрашивает WordInfoTemps таблицу, и при наличие данных обрабатывает их и складывает в WordInfo таблицу, при этом удаляя из WordInfoTemps таблицы;
4. WEB API DB Client - клиент для общения с АПИ, который использует консольный клиент.

Почему API DB?
1. Идея заключалась в том, чтобы снять отвественность работы с БД с клиентов;
2. Апи использует Hangfire, что позволяет поставить Job, например, Insert и если по какой-то причине будут проблемы, то при помощи джобы мы не потеряем эти данные и они в любом случае попадут в таблицу. Также возможность настроить повторяющуюся джобу, которая сама будет апдейтить таблицу.

Также у WEB API DB есть две технологии для которых предусмотрен интерфейс:
1. Swagger - является стартовой страницей, можно перейти по URL: host/swagger;
![image](https://github.com/BloodWod-513/DocumentWorker/assets/33897884/5e66dcb2-c044-430f-aa30-417dc4003e5f)
2. Hangfire - информационная панель планировщика задач, можно перейти по URL: host/dashboard;
![image](https://github.com/BloodWod-513/DocumentWorker/assets/33897884/17b44723-04fe-4381-b351-360b0a197559)
![image](https://github.com/BloodWod-513/DocumentWorker/assets/33897884/bfaf3476-c86f-4c2d-b0ab-4ad51eaf39f1)

## Структура проекта
Проект DocumentWorker содержит в себе несколько проектов:
1. DocumentWorker - само консольное приложение, которое при запуске считывает текст из файла, парсит его и отправляет в апи.
    * DocumentWorker - точка запуска консольного клиента, который запускается, вызывает настройку и читает файл, не содержит ничего особого;
    * DocumentWorker.DTO - проект, который содержит в себе модели, домейны и т.п., для консольного приложения;
    * DocumentWorker.Infrastructure - проект, содержащий в себе всю основную логику для работы с консольным клиентом;
    * DocumentWorker.Tests - чуть-чуть тесты, скудный набор, не особо полезны.
2. DocumentWorker.DB.API - апи для взаимодействия с базой данных, вызова джоб.
    * DocumentWorker.DB.Client - клиент для общения с АПИ, в нем описаны запросы в апи, подключаем в проект и пользуемся готовыми запросами.
    * DocumentWorker.APIDB.DTO - проект, который содержит в себе модели, домейны и т.п., для апи;
3. AutofacWrapper - обвертка Autofac для более удобной регистрации зависимостей.

## Используемые технологии
Тут будут описаны некоторые технологии, которые по-моему мнение можно выделить:
* Autofac;
* NLoger;
* Hangfire;
* Swagger;

## Как запускать проект
  !! Используется БД localhost
  1. В DocumentWorker используется Hangfire (ему нужна БД), в проекте DocumenWorker.DB.API в папке Scripts лежит SQL скрипт для создания БД и таблиц;
  2. После создания БД необходимо запустить само апи;
  3. Теперь можно запускать консольные клиенты.
Файл для считывания с названием "ForRead.txt" генерируется рядом с DocumentWorker.exe в папке TxtFiles, при необходимости можно менять текст в нем.
Также рядом с DocumentWorker.exe приложен батник "Execute10exe.bat" для запуска сразу 10 клиентов, при необходимости можно изменить.

## Как помочь проекту
Параллельно с работой сложно релизовать все идеи :(
  1. Доработать выборочное считывание проекту, то есть, дать возможность выбирать, какой файл считать;
  2. Создать, например, абстрактную фабрику, которая при помощи формата файла будет определять и выбирать стратегию обработки файла (если планируются друие форматы в дальнейшем);
  3. Улучшить систему логирования;
  4. Добавить больше обработок, например, если клиент отправил пост запрос, а апи вернуло false, то есть запрос не дошел (например апи упало), то необходимы ретраи, лучше вариантом будет создание какой-нибудь очереди, чтобы точно не потерять запросы.

## Автор
BloodWod-513 </br>
P.S. Я согласен, что мои идеи и архитектурные решения не идеальны, но я стараюсь становиться лучше
<picture>
  <source media="(prefers-color-scheme: dark)" srcset="https://user-images.githubusercontent.com/25423296/163456776-7f95b81a-f1ed-45f7-b7ab-8fa810d529fa.png">
  <source media="(prefers-color-scheme: light)" srcset="https://user-images.githubusercontent.com/25423296/163456779-a8556205-d0a5-45e2-ac17-42d089e3c3f8.png">
  <img alt="Shows an illustrated sun in light mode and a moon with stars in dark mode." src="https://user-images.githubusercontent.com/25423296/163456779-a8556205-d0a5-45e2-ac17-42d089e3c3f8.png">
</picture>
